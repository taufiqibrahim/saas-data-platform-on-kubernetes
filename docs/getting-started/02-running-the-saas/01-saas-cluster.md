# Setting Up SaaS Cluster

## Install kind

```bash
go install sigs.k8s.io/kind@v0.31.0
```
## Creating The Cluster

Here we will use `kind` CLI in combination with config file. This way we have more control on how the cluster will be deployed.

The example YAML config can be found on `deployments/saas/kind-saas-cluster.yaml`.
```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: saas-cluster
nodes:
  - role: control-plane
  - role: worker
```

That example configuration:

- Create a kind cluster named `saas-cluster`
- There will be 1 worker node

Feel free to experiment with our own configuration by refering to [https://kind.sigs.k8s.io/docs/user/configuration/](https://kind.sigs.k8s.io/docs/user/configuration/).

Now let's deploy the cluster:
```bash
cd deployments/saas/
kind create cluster --config=kind-saas-cluster.yaml
```

## Interacting With The Cluster

After creating a cluster, we can use `kubectl` to interact with it by using the configuration file generated by kind.

To see all the clusters we have created, we can use the `get clusters` command.

```bash
kind get clusters
saas-cluster
```

In order to interact with a specific cluster, we need to specify the cluster name as a context in `kubectl` as the current context:
```bash
kubectl config use-context kind-tenant-cluster
```

## Preparing Secrets

Setup `ghcr.io` pull secret
```bash
kubectl create secret docker-registry dockerio-pull-secret \
  --docker-server=ghcr.io \
  --docker-username=YOUR_GITHUB_USERNAME \
  --docker-password=YOUR_GITHUB_PAT \
  --docker-email=any@email.com \
  -n default
```

Setup `docker.io` pull secret
```bash
kubectl create secret docker-registry ghcr-secret \
  --docker-server=docker.io \
  --docker-username=YOUR_DOCKER_USERNAME \
  --docker-password=YOUR_DOCKER_PAT \
  --docker-email=any@email.com \
  -n default
```

Now we're ready to use the cluster.
